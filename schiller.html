<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boston College Page</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@700&display=swap" rel="stylesheet"> <!-- Rugged Font -->
    <link href="https://fonts.googleapis.com/css2?family=Rock+Salt&display=swap" rel="stylesheet"> <!-- Rugged, Vintage Font -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        /* Ensure the html and body take up the full viewport */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif; /* Default font style for the page */
            position: relative; /* Ensure the positioning is relative for child elements */
        }

        body::before {
            content: ''; /* Required for pseudo-element */
            background-image: url('images/BC.jpeg'); /* Path to your background image */
            background-size: cover; /* Cover the entire background */
            background-position: center; /* Center the background */
            background-repeat: no-repeat; /* Prevent background image from repeating */
            position: absolute; /* Position it absolutely */
            top: 0; /* Align it to the top */
            left: 0; /* Align it to the left */
            right: 0; /* Align it to the right */
            bottom: 0; /* Align it to the bottom */
            opacity: 0.5; /* Set the opacity of the background image */
            z-index: 0; /* Ensure it's below other elements */
        }

        /* Set styles for the top container */
        .top-container {
            height: 15%; /* Adjusted height */
            width: 100%;
            display: flex; /* Use flexbox for layout */
            flex-direction: column; /* Stack items vertically */
            align-items: center; /* Center items horizontally */
            position: fixed; /* Change to fixed positioning */
            top: 0; /* Align to the top of the viewport */
            left: 0; /* Align to the left of the viewport */
            background-color: #BC9B6A; /* Optional: background color */
            z-index: 1;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* Soft shadow around the container */
        }

/* Pseudo-element for blurry white bottom edge */
.top-container::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 10%; /* Adjust height for the blurry effect */
    background: rgba(255, 255, 255, 0.8); /* White background with transparency */
    filter: blur(15px); /* Apply blur */
    z-index: -1; /* Ensure it stays behind the content */
}

/* Pseudo-element for blurry white top edge */
.top-container::before {
    content: '';
    position: absolute;
    top: 0; /* Position at the top */
    left: 0;
    right: 0;
    height: 14%; /* Adjust height for the blurry effect */
    background: rgba(255, 255, 255, 0.8); /* White background with transparency */
    filter: blur(18px); /* Apply blur */
    z-index: -1; /* Ensure it stays behind the content */
}
        
        /* Set styles for the logo */
        .logo {
            max-height: 80px; /* Reduced height of the logo */
            position: absolute; /* Position it absolutely */
            top: 18px; /* Position from the top */
            left: 10px; /* Position from the left */
        }
        
        /* Title styles */
        .title {
            font-family: 'Rock Salt', cursive; /* Vintage font */
            font-size: 48px; /* Increase font size */
            font-weight: 900; /* Bold font */
            margin-top: 0px; /* Adjusted margin to move it higher */
            text-align: center; /* Center text */
            color: #98002E;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7); /* Text shadow for contrast */
        }
        
        /* Subtitle styles */
        .subtitle {
            font-size: 16px; /* Smaller font size */
            color: gray; /* Optional: change color */
            text-align: center; /* Center text */
            margin-top: -22px; /* Adjusted position to move it higher */
            color: #98002E;
        }
        
        /* Set styles for the buttons */
        .button {
            position: absolute; /* Absolute positioning */
            width: 60px; /* Increased width for profile button */
            height: 60px; /* Increased height for profile button */
            background-color: transparent; /* Transparent background */
            cursor: pointer; /* Pointer cursor on hover */
            padding: 0;
            border: none; /* Remove any border */
            border-radius: 50%; /* Make buttons circular */
        }
        
        /* Position the profile button */
        .profile-button {
            top: 18px; /* Position from the top */
            right: 45px; /* Position from the right */
        }
        

        /* Map styles */
        #map {
            transform: translate(-50%, -40%); /* Center the map */
            height: 70%; /* Adjust height to make the map smaller */
            width: 70%; /* Adjust width to make the map smaller */
            margin: auto; /* Center the map horizontally */
            border-radius: 20px; /* Optional: rounded corners */
            border: 5px solid black; /* Add border */
            position: absolute; /* Use absolute positioning to center */
            top: 50%; /* Position from the top */
            left: 50%; /* Position from the left */
            z-index: 1; /* Ensure it's above other elements */
        }

        .bottom-image {
            height: calc(85% - 60px); /* 3/4 of the page */
            width: calc(100% - 60px); /* Full width minus padding */
            margin: 30px; /* Add margin to create space around the image */
            background-image: url('images/BCMap.png');
            background-size: cover; /* Ensure the image covers the space */
            background-position: center; /* Center the image */
            border-radius: 20px; /* Optional: rounded corners */
        }
    </style>
</head>
<body>
    <div class="top-container">
        <img src="images/BCLogo.png" alt="Boston College Logo" class="logo">
        <div class="title">Study Together</div>
        <div class="subtitle">(or by yourself)</div>
        <!-- Profile button linking to profile.html -->
        <a href="profile.html" class="button profile-button">
            <img src="images/profile.png" alt="Profile" style="width: 130%; height: 130%; object-fit: cover;">
        </a>
    </div>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }

        h1 {
            margin-bottom: 20px;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(4, 100px);
            grid-template-rows: repeat(3, 100px);
            gap: 10px;
            grid-auto-flow: column;
            align-content: end; /* Aligns the grid to the bottom */
        }

        .room {
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid #333;
            background-color: #BC9B6A; /* Unoccupied color */
            color: black;
            cursor: pointer;
            position: relative;
            font-size: 20px;
            height: 100px; /* Fixed height for room representation */
        }

        .room.occupied {
            background-color: maroon; /* Occupied color */
        }

        .selector-container {
            margin: 20px;
        }

        .time-selector,
        .day-selector {
            margin-bottom: 10px;
        }

        /* Modal styles */
        #modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
            padding-top: 60px;
        }

        #modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            text-align: center;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Center the buttons */
        #occupy-button,
        #studying-button {
            display: inline-block;
            margin: 10px;
        }
    </style>
</head>
<body>
    <div class="selector-container">
        <div class="time-selector">
            <label for="time">Select Time: </label>
            <input type="time" id="time" value="12:00">
        </div>
        <div class="day-selector">
            <label for="day">Select Day: </label>
            <select id="day">
                <option value="Su">Sunday</option>
                <option value="M">Monday</option>
                <option value="Tu">Tuesday</option>
                <option value="W">Wednesday</option>
                <option value="Th">Thursday</option>
                <option value="F">Friday</option>
                <option value="Sa" selected>Saturday</option>
            </select>
        </div>
    </div>
    <div class="grid-container" id="room-grid">
        <!-- Rooms will be populated here -->
    </div>

    <!-- Modal for class info -->
    <div id="modal">
        <div id="modal-content">
            <span class="close" id="back-button">&times;</span>
            <p id="modal-message"><span id="occupant-name"></span></p>
            <button id="occupy-button">Room is Already Occupied</button>
            <button id="studying-button">I am Studying Here</button>
        </div>
    </div>

    <script>
        let classSchedules = []; // This will hold the JSON data
        let currentRoom = null; // Current room being interacted with

        // Function to fetch the JSON data
        async function fetchRoomData() {
            try {
                const response = await fetch('/room_schedule.json'); // Adjust the path as necessary
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                classSchedules = await response.json(); // Parse JSON data
                populateRooms(document.getElementById('time').value, document.getElementById('day').value); // Populate rooms after fetching
            } catch (error) {
                console.error('Error fetching room data:', error);
            }
        }

        // Function to populate rooms
        function populateRooms(selectedTime, selectedDay) {
            const roomGrid = document.getElementById('room-grid');
            roomGrid.innerHTML = ''; // Clear previous room elements

            // Get the current time's hours and minutes
            const [selectedHour, selectedMinute] = selectedTime.split(':').map(Number);
            const currentTime = selectedHour * 60 + selectedMinute; // Convert to minutes for easier comparison

            // Add rooms to the grid in tower shape
            const uniqueRooms = {};

            classSchedules.forEach(schedule => {
                console.log("Processing schedule:", schedule);
                const roomNumber = schedule.room;
                if (!uniqueRooms[roomNumber]) {
                    uniqueRooms[roomNumber] = { room: roomNumber, occupied: false, course_title: '' };
                }

                // Check if the room is occupied at the selected time and day
                if (schedule.days.includes(selectedDay)) {
                    for (const period of schedule.schedule) {
                        const [startHour, startMinute] = convertTimeToMinutes(period.start);
                        const [endHour, endMinute] = convertTimeToMinutes(period.end);

                        // Check if the current time falls within the class schedule
                        if (currentTime >= startHour * 60 + startMinute && currentTime < endHour * 60 + endMinute) {
                            uniqueRooms[roomNumber].occupied = true; // Mark room as occupied
                            uniqueRooms[roomNumber].course_title = schedule.course_title; // Assign the course title
                            console.log(`Room: ${roomNumber}, Course Title: ${uniqueRooms[roomNumber].course_title}`); // Debugging
                            break;
                        }
                    }
                }
            });

            // Unique room numbers organized by floor
            const roomOrder = ['102', '103', '104', '107', '123', '125', '204', '205', '214', '215', '229', '230', '302', '311']; // Example order
            roomOrder.forEach(roomNumber => {
                if (uniqueRooms[roomNumber]) {
                    const roomDiv = document.createElement('div');
                    roomDiv.className = 'room' + (uniqueRooms[roomNumber].occupied ? ' occupied' : '');
                    roomDiv.dataset.room = roomNumber;
                    roomDiv.textContent = `Room ${roomNumber}`;

                    // Add click event listener for room interaction
                    roomDiv.addEventListener('click', () => handleRoomClick(uniqueRooms[roomNumber]));
                    
                    roomGrid.appendChild(roomDiv);
                }
            });
        }

        // Convert time string to minutes
        function convertTimeToMinutes(time) {
            const [timeString, modifier] = time.split(' ');
            let [hours, minutes] = timeString.split(':').map(Number);

            if (modifier === 'PM' && hours < 12) hours += 12;
            if (modifier === 'AM' && hours === 12) hours = 0;

            return [hours, minutes];
        }
        function handleRoomClick(room) {
            currentRoom = room; // Set the current room
            const modal = document.getElementById('modal');
            const occupantNameSpan = document.getElementById('occupant-name');

            // Show appropriate message based on the room state
            if (room.occupied && room.course_title) {
                occupantNameSpan.textContent = `Occupied by: ${room.course_title}`; // Display course title if occupied
                document.getElementById('occupy-button').style.display = 'none'; // Hide occupy button
                document.getElementById('studying-button').style.display = 'none'; // Hide studying button
            } else {
                occupantNameSpan.textContent = "Available"; // Show available message
                document.getElementById('occupy-button').style.display = 'inline-block'; // Show occupy button
                document.getElementById('studying-button').style.display = 'inline-block'; // Show studying button
            }

            modal.style.display = 'block'; // Show modal
        }


        // Function to handle occupying the room
        function handleOccupyRoom() {
            if (currentRoom) {
                currentRoom.occupied = true;
                currentRoom.course_title = "";
                const roomDiv = document.querySelector(`[data-room="${currentRoom.room}"]`);
                roomDiv.classList.add('occupied');
                roomDiv.textContent = `Room ${currentRoom.room}`;
                roomDiv.style.display = 'flex';
                roomDiv.style.justifyContent = 'center';
                roomDiv.style.alignItems = 'center';
                document.getElementById('modal').style.display = 'none';
                
                // Update the room data in the uniqueRooms array
                const roomIndex = uniqueRooms.findIndex(room => room.room === currentRoom.room);
                if (roomIndex !== -1) {
                    uniqueRooms[roomIndex] = currentRoom;
                }
                
                // Re-populate the rooms to reflect the changes
                populateRooms(document.getElementById('time').value, document.getElementById('day').value);
            }
        }

        function handleStudying() {
            if (currentRoom) {
                const occupantName = prompt("Please enter your name:");
                if (occupantName) {
                    currentRoom.occupied = true;
                    currentRoom.course_title = `${occupantName} - Studying`;
                    const roomDiv = document.querySelector(`[data-room="${currentRoom.room}"]`);
                    roomDiv.classList.add('occupied');
                    roomDiv.textContent = `Room ${currentRoom.room}`;
                    roomDiv.style.display = 'flex';
                    roomDiv.style.justifyContent = 'center';
                    roomDiv.style.alignItems = 'center';
                    document.getElementById('modal').style.display = 'none';
                    
                    // Update the room data in the uniqueRooms array
                    const roomIndex = uniqueRooms.findIndex(room => room.room === currentRoom.room);
                    if (roomIndex !== -1) {
                        uniqueRooms[roomIndex] = currentRoom;
                    }
                    
                    // Re-populate the rooms to reflect the changes
                    populateRooms(document.getElementById('time').value, document.getElementById('day').value);
                }
            }
        }

        // Close modal when clicking the close button
        document.getElementById('back-button').onclick = function() {
            document.getElementById('modal').style.display = 'none';
        }

        // Event listener for the time selector
        document.getElementById('time').addEventListener('change', (event) => {
            populateRooms(event.target.value, document.getElementById('day').value);
        });

        // Event listener for the day selector
        document.getElementById('day').addEventListener('change', (event) => {
            populateRooms(document.getElementById('time').value, event.target.value);
        });

        // Event listeners for modal buttons
        document.getElementById('occupy-button').onclick = handleOccupyRoom;
        document.getElementById('studying-button').onclick = handleStudying;

        // Fetch room data when the page loads
        window.onload = fetchRoomData;
    </script>
</body>
</html>